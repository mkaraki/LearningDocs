# SQLを書いてみよう

## 対象者
- Windowsが使える
- 最低限コマンドプロンプトを扱える

## 概要
> 関係データベース（かんけいデータベース、リレーショナルデータベース、英: relational database）は、関係モデル（リレーショナルデータモデル、後述）にもとづいて設計、開発されるデータベースである。関係データベースを管理するデータベース管理システム (DBMS) を関係データベース管理システム (RDBMS) と呼ぶ。
>
> \- Wikipedia

この章では、RDBMSの命令文であるSQLについて扱う。

## 実行環境
今回の演習では、[SQLite](https://www.sqlite.org/)を利用する。

あらかじめ[DBOnlineの記事](https://www.dbonline.jp/sqlite/install/index1.html)を参照し、`sqlite3.exe`を利用できる状態にしておくこと。

今回の実習ではコマンドプロンプトを利用する（PowerShellではない）。
あらかじめ`sqlite3.exe`の存在するディレクトリでコマンドプロンプトを起動すること。

**注意:** 一般的によく使われているデータベースとして[MySQL](https://www.mysql.com/)が存在します。
SQLiteはMySQLと異なるところが数多くあることを事前知識として覚えてください。
今回は導入の手軽さからSQLiteを利用しているだけであり、多くの場合、本番環境で利用されるのはMySQLです。

**注意:** SQLiteはSQLのすべての仕様に対応しているわけではありません。
今回の資料ではあくまで基礎的な部分を説明するため、SQLiteで十分ですが、将来的にはMySQLの構文を知っておいたほうが良いかもしれません。
MySQLとの対比はこの資料では記述しませんが、もしやる気があるのでしたら、実際にMySQLでも同じ工程をたどってみてください。

## データベースの作成
SQLiteはMySQLなどの一般的なRDBMSと違い、ホストではなく、ファイルにデータを記録する。
また、MySQLではホスト内にデータベースを複数作成できるが、SQLiteでは1ファイル1データベースである。

下記のコマンドで`test.sqlite3`というデータベース（ファイル）を作成する。
2回目以降の実行では、`test.sqlite3`を開くという意味に変化する。
```cmd
> sqlite3 test.sqlite3
```

コマンドプロンプトの先頭のプロンプトが、ディレクトリパスから`sqlite>`に変化すれば、正常に編集モードに入れているということである。

## テーブル
関係データベースはExcelの表を思い浮かべてもらうとわかりやすいであろう。
テーブルはExcelでいうシートに当たる。

関係データベースのテーブルでは、先に列とデータ型を定義する必要がある。

```sql
CREATE TABLE テーブル名(列名 データ型 [オプション] [, ...]);
```

列のうち最低1列には必ず`PRIMARY KEY`オプションを設定しなければならない。
PRIMARY KEYを設定した列のデータはそのテーブルの中で一意でなければならない。

例として、次の列を持つテーブル`employee`を作る。
|列名|データ型|備考|
|:--|:--|:--|
|id|INTEGER|Primary Key|
|name|TEXT||

コードはこのようになる。
```sql
CREATE TABLE employee(id INTEGER PRIMARY KEY, name TEXT);
```

## データの取得
データの取得は`SELECT`文を利用する。

今回はとてもシンプルな構文を提示する。
```sql
SELECT 列名[, ...] FROM テーブル名 [オプション ...];
```

また、すべての列を取得する場合は、次のように書ける
```sql
SELECT * FROM テーブル名 [オプション ...];
```

例として、`employee`テーブルからすべての項目を取得するコードを提示する。
しかし、現在`employee`テーブルの中は空であるため、何も表示されない。

今後データの編集を行うため、編集処理後に見比べる用途でコードを使うと良いだろう。
```sql
SELECT * FROM employee;
```

また、`SELECT`文では、[WHEREを使った条件式](#WHEREを使った条件式)で対象を検索することが可能である。
試してみると良い。

## データの追加
データの追加をする場合は、`INSERT`文を利用する。

構文はこのようになっている。
```sql
INSERT INTO デーブル名 [(列名 [, ...])] VALUES(値, [, ...]) [,(値 [, ...])];
```

複雑なため、わかりやすく説明する。

`INSERT`文では、`INSERT INTO テーブル名`の部分で、どのテーブルに追加するかを指定できる。
そして、挿入しない列がある場合は、テーブル名の後に`()`を付けて、その中に**挿入する**列名を入力する

`VALUES`以下の`()`に挿入するデータを入力する。複数行を同時に挿入したい場合、`()`間を`,`で区切り複数指定する。

例として、`employee`テーブルに`(id=1, name=abc)`と`(id=2, name=def)`というレコードを追加するコードを提示する。
```sql
INSERT INTO employee VALUES(1, 'abc'),(2, 'def');
```

## WHEREを使った条件式
次に進む前にWHEREを使った条件式の書き方を説明する。

基本的には下記の形式を取る。今回は、2行目にサンプルを用意した。
```sql
WHERE 列名 比較演算子 値
WHERE id = 1
```

サンプルの例では、`id`列の値が`1`の人物が検索に引っかかる。

比較演算子には下記がある。

下記の表を見る際は、`列名 は 値 より [意味]`のように差し替えて読むとわかりやすいかもしれない。

|演算子|意味|
|:--|:--|
|=|等しい|
|<>|等しくない|
|<|小さい|
|>|大きい|
|<=|以下|
|>=|以上|

## データの削除
データの削除は`DELETE`文を利用する。

構文は下記のようになっている。
```sql
DELETE FROM テーブル名 WHERE 条件式;
```

削除対象は[WHEREを使った条件式](#WHEREを使った条件式)で指定する。

例では、`employee`テーブルから、`id`が`2`のレコードを削除している。
```sql
DELETE FROM employee WHERE id = 2;
```

## データの編集
データの編集では、`UPDATE`文を利用する。

構文は下記のようになる。
```sql
UPDATE テーブル名 SET 列名 = 値 [, ...] WHERE 条件式;
```

`列名 = 値`では、新しい値を指定する。

編集対象は[WHEREを使った条件式](#WHEREを使った条件式)で指定する。

例では、`employee`テーブルの、`id`が`1`のレコードの`name`を`ghi`に設定している。
```sql
UPDATE employee SET name = 'ghi' WHERE id = 1;
```
